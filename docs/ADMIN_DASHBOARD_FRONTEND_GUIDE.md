# Admin Dashboard Frontend Guide (Angular)

## Purpose
This guide explains how Angular frontend should integrate the unified admin dashboard endpoint:
- endpoint and auth requirements
- request/response contract
- data flow in frontend
- KPI meanings and decision use cases
- recommended UI mapping

---

## Endpoint

### Main dashboard endpoint
- `GET /api/v1/admin/analytics/dashboard`

### Query params
- `windowDays` (optional, default: `30`)
- Backend clamps this value to range `7..365`

### Auth
- Requires JWT Bearer token
- Requires `ADMIN` role

### Related endpoint (legacy summary)
- `GET /api/v1/admin/analytics/overview`
- Use this only for simple counters; use `/dashboard` for full dashboard page

---

## Request Example

```http
GET /api/v1/admin/analytics/dashboard?windowDays=30
Authorization: Bearer <access_token>
```

---

## Response Example

```json
{
  "generatedAt": "2026-02-20T11:22:33.120",
  "windowDays": 30,
  "snapshot": {
    "totalRevenuePaid": 125430.00,
    "revenueInWindow": 18420.00,
    "revenuePreviousWindow": 16200.00,
    "revenueGrowthPercent": 13.70
  },
  "booking": {
    "totalBookings": 1284,
    "bookingsInWindow": 122,
    "activeBookings": 38,
    "overdueActiveBookings": 4,
    "completionRatePercent": 68.03,
    "cancellationRatePercent": 14.75
  },
  "fleet": {
    "totalVehicles": 210,
    "availableVehicles": 54,
    "reservedVehicles": 60,
    "rentedVehicles": 72,
    "maintenanceVehicles": 24,
    "utilizationRatePercent": 62.86,
    "availabilityRatePercent": 25.71
  },
  "customer": {
    "totalCustomers": 942,
    "newCustomersInWindow": 74,
    "repeatCustomerRatePercent": 41.28
  },
  "payment": {
    "totalPayments": 1590,
    "paidPayments": 1402,
    "failedPayments": 93,
    "paymentSuccessRatePercent": 93.77,
    "outstandingReceivables": 10540.00
  },
  "experience": {
    "totalReviews": 641,
    "pendingReviews": 28,
    "approvedReviews": 590,
    "averageApprovedRating": 4.52
  },
  "demand": {
    "vehicleBookingsInWindow": 122,
    "excursionBookingsInWindow": 41,
    "circuitBookingsInWindow": 36,
    "dominantChannel": "VEHICLE_RENTAL"
  },
  "alerts": [
    "Payment success rate is below 90%. Check payment provider errors and failed checkout events."
  ]
}
```

---

## Field Semantics (What each KPI means)

### `snapshot`
- `totalRevenuePaid`: all-time paid revenue
- `revenueInWindow`: paid revenue in current window
- `revenuePreviousWindow`: paid revenue in previous same-length window
- `revenueGrowthPercent`: growth vs previous window

### `booking`
- `bookingsInWindow`: number of vehicle bookings created in window
- `overdueActiveBookings`: bookings still ACTIVE but end date passed (operational risk)
- `completionRatePercent`: completed / bookings in window
- `cancellationRatePercent`: canceled / bookings in window

### `fleet`
- `utilizationRatePercent`: `(reserved + rented) / totalVehicles * 100`
- `availabilityRatePercent`: `available / totalVehicles * 100`

### `customer`
- `newCustomersInWindow`: users created in window
- `repeatCustomerRatePercent`: percent of customers with >=2 non-canceled vehicle bookings

### `payment`
- `paymentSuccessRatePercent`: paid / (paid + failed) in window
- `outstandingReceivables`: unpaid remaining amounts on non-canceled bookings

### `experience`
- `averageApprovedRating`: average rating from approved reviews
- `pendingReviews`: moderation backlog size

### `demand`
- Mix of booking channels in window:
  - vehicle rentals
  - excursions
  - circuits
- `dominantChannel`: channel with highest volume

### `alerts`
- Decision-support messages generated by backend thresholds
- Show prominently in dashboard header or “Action Center”

---

## Angular Integration

## 1) TypeScript Models

```ts
export interface AdminDashboardResponse {
  generatedAt: string;
  windowDays: number;
  snapshot: SnapshotMetrics;
  booking: BookingMetrics;
  fleet: FleetMetrics;
  customer: CustomerMetrics;
  payment: PaymentMetrics;
  experience: ExperienceMetrics;
  demand: DemandMetrics;
  alerts: string[];
}

export interface SnapshotMetrics {
  totalRevenuePaid: number;
  revenueInWindow: number;
  revenuePreviousWindow: number;
  revenueGrowthPercent: number;
}

export interface BookingMetrics {
  totalBookings: number;
  bookingsInWindow: number;
  activeBookings: number;
  overdueActiveBookings: number;
  completionRatePercent: number;
  cancellationRatePercent: number;
}

export interface FleetMetrics {
  totalVehicles: number;
  availableVehicles: number;
  reservedVehicles: number;
  rentedVehicles: number;
  maintenanceVehicles: number;
  utilizationRatePercent: number;
  availabilityRatePercent: number;
}

export interface CustomerMetrics {
  totalCustomers: number;
  newCustomersInWindow: number;
  repeatCustomerRatePercent: number;
}

export interface PaymentMetrics {
  totalPayments: number;
  paidPayments: number;
  failedPayments: number;
  paymentSuccessRatePercent: number;
  outstandingReceivables: number;
}

export interface ExperienceMetrics {
  totalReviews: number;
  pendingReviews: number;
  approvedReviews: number;
  averageApprovedRating: number;
}

export interface DemandMetrics {
  vehicleBookingsInWindow: number;
  excursionBookingsInWindow: number;
  circuitBookingsInWindow: number;
  dominantChannel: 'VEHICLE_RENTAL' | 'EXCURSION' | 'CIRCUIT';
}
```

## 2) Angular Service

```ts
import { HttpClient, HttpParams } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { AdminDashboardResponse } from './admin-dashboard.model';

@Injectable({ providedIn: 'root' })
export class AdminAnalyticsApi {
  private readonly baseUrl = '/api/v1/admin/analytics';

  constructor(private http: HttpClient) {}

  getDashboard(windowDays = 30): Observable<AdminDashboardResponse> {
    const params = new HttpParams().set('windowDays', String(windowDays));
    return this.http.get<AdminDashboardResponse>(`${this.baseUrl}/dashboard`, { params });
  }
}
```

## 3) Component Flow

1. On init:
- load dashboard with default `windowDays = 30`

2. On filter change (7, 30, 90, 365):
- call endpoint with selected window
- replace full dashboard state atomically

3. Auto refresh:
- recommended every `60s` on active page
- also refresh on manual action (button)

4. Loading and error states:
- show skeletons while loading
- keep previous data visible during refresh
- show retry action on HTTP failure

---

## UI Mapping Recommendation

### Top row (executive KPIs)
- Revenue in window
- Revenue growth %
- Bookings in window
- Payment success %

### Operational row
- Fleet utilization %
- Fleet availability %
- Active bookings
- Overdue active bookings (badge red if > 0)

### Financial row
- Outstanding receivables
- Failed payments count
- Cancellation rate %
- Completion rate %

### Quality and demand row
- Average approved rating
- Pending reviews
- Demand mix chart (vehicle vs excursion vs circuit)
- Dominant channel badge

### Alert panel
- render each `alerts[]` item as high-visibility alert card

---

## Decision Use Cases

### 1) Revenue dropping while bookings stable
- Check `revenueGrowthPercent` and `bookingsInWindow`
- Action: review average order value, pricing, discount leakage

### 2) High cancellations
- Check `cancellationRatePercent`
- Action: inspect cancellation reasons, stock accuracy, time-to-confirm

### 3) Fleet saturation risk
- Check `availabilityRatePercent` + `utilizationRatePercent`
- Action: rebalance locations, reduce maintenance overlap, expand active fleet

### 4) Payment funnel issue
- Check `failedPayments` + `paymentSuccessRatePercent`
- Action: audit payment provider logs, retry strategy, checkout UX

### 5) Cash collection pressure
- Check `outstandingReceivables`
- Action: prioritize dunning/reminders and partial-payment follow-up

### 6) Quality/reputation risk
- Check `pendingReviews` + `averageApprovedRating`
- Action: clear moderation backlog, investigate low-rating spikes

---

## Recommended Frontend Behaviors

- Always use currency format for money fields
- Display percentages with 1-2 decimals
- Show `generatedAt` in local timezone
- Do not recompute KPIs on frontend; treat backend as source of truth
- If `alerts` is empty, show “No critical alerts”

---

## Error Handling

Expected statuses:
- `200`: success
- `401`: missing/invalid token
- `403`: not admin
- `500`: backend failure

Frontend rule:
- `401` -> redirect to login/refresh flow
- `403` -> show “Access denied”
- `500` -> show retry + keep previous values if available

---

## Testing Checklist (Frontend)

- Loads default dashboard on page open
- Window filter sends correct `windowDays`
- Values update when window changes
- Alerts render correctly when list is empty/non-empty
- Money and percentage formatting is consistent
- 401/403/500 states handled correctly

---

## Quick API Summary

- `GET /api/v1/admin/analytics/dashboard?windowDays=30`
- Bearer token required
- Admin role required
- Returns complete dashboard payload in one request

